/* Generated by Nim Compiler v0.11.3 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
/* Compiled for: Linux, amd64, gcc */
/* Command for C compiler:
   gcc -c  -w -Os  -I/data4/NimCompiler/Nim/lib -o /data4/NimStuff/NimFinLib/nimcache/stdlib_net.o /data4/NimStuff/NimFinLib/nimcache/stdlib_net.c */
#define NIM_INTBITS 64
#include "nimbase.h"

#include <string.h>

#include <sys/socket.h>

#include <netdb.h>

#include <setjmp.h>

#include <errno.h>
typedef struct Sslstruct210405 Sslstruct210405;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct Sslerror212205 Sslerror212205;
typedef struct Exception Exception;
typedef struct TNimObject TNimObject;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct Cell44747 Cell44747;
typedef struct Cellseq44763 Cellseq44763;
typedef struct Gcheap46616 Gcheap46616;
typedef struct Cellset44759 Cellset44759;
typedef struct Pagedesc44755 Pagedesc44755;
typedef struct Memregion26610 Memregion26610;
typedef struct Smallchunk25843 Smallchunk25843;
typedef struct Llchunk26604 Llchunk26604;
typedef struct Bigchunk25845 Bigchunk25845;
typedef struct Intset25817 Intset25817;
typedef struct Trunk25813 Trunk25813;
typedef struct Avlnode26608 Avlnode26608;
typedef struct Gcstat46614 Gcstat46614;
typedef struct Ioerror3431 Ioerror3431;
typedef struct Systemerror3429 Systemerror3429;
typedef struct Socketimpl212410 Socketimpl212410;
typedef struct TSafePoint TSafePoint;
typedef struct Ipaddress212463 Ipaddress212463;
typedef struct Valueerror3449 Valueerror3449;
typedef struct Slice83964 Slice83964;
typedef struct Oserror3433 Oserror3433;
typedef struct TY215429 TY215429;
typedef struct Timeouterror212418 Timeouterror212418;
typedef struct Basechunk25841 Basechunk25841;
typedef struct Freecell25833 Freecell25833;
typedef N_CDECL_PTR(int, TY210582) (void);
typedef N_CDECL_PTR(void, TY210587) (void);
typedef N_CDECL_PTR(void, TY210592) (void);
typedef N_CDECL_PTR(void, TY211034) (void);
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_CDECL_PTR(Sslstruct210405*, TY210634) (Sslstruct210405* meth);
typedef N_CDECL_PTR(Sslstruct210405*, TY210602) (void);
typedef N_NIMCALL_PTR(void, TY3289) (void* p, NI op);
typedef N_NIMCALL_PTR(void*, TY3294) (void* p);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY3289 marker;
TY3294 deepcopy;
};
struct  TNimObject  {
TNimType* m_type;
};
struct  Exception  {
  TNimObject Sup;
Exception* parent;
NCSTRING name;
NimStringDesc* message;
NimStringDesc* trace;
};
struct  Sslerror212205  {
  Exception Sup;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  Cell44747  {
NI refcount;
TNimType* typ;
};
struct  Cellseq44763  {
NI len;
NI cap;
Cell44747** d;
};
struct  Cellset44759  {
NI counter;
NI max;
Pagedesc44755* head;
Pagedesc44755** data;
};
typedef Smallchunk25843* TY26622[512];
typedef Trunk25813* Trunkbuckets25815[256];
struct  Intset25817  {
Trunkbuckets25815 data;
};
struct  Memregion26610  {
NI minlargeobj;
NI maxlargeobj;
TY26622 freesmallchunks;
Llchunk26604* llmem;
NI currmem;
NI maxmem;
NI freemem;
NI lastsize;
Bigchunk25845* freechunkslist;
Intset25817 chunkstarts;
Avlnode26608* root;
Avlnode26608* deleted;
Avlnode26608* last;
Avlnode26608* freeavlnodes;
};
struct  Gcstat46614  {
NI stackscans;
NI cyclecollections;
NI maxthreshold;
NI maxstacksize;
NI maxstackcells;
NI cycletablesize;
NI64 maxpause;
};
struct  Gcheap46616  {
void* stackbottom;
NI cyclethreshold;
Cellseq44763 zct;
Cellseq44763 decstack;
Cellset44759 cycleroots;
Cellseq44763 tempstack;
NI recgclock;
Memregion26610 region;
Gcstat46614 stat;
};
typedef N_CDECL_PTR(int, TY211029) (void);
typedef N_CDECL_PTR(NCSTRING, TY211017) (int e, NCSTRING buf);
typedef N_CDECL_PTR(Sslstruct210405*, TY210612) (void);
typedef N_CDECL_PTR(Sslstruct210405*, TY210617) (void);
typedef N_CDECL_PTR(int, TY210672) (Sslstruct210405* s, NCSTRING ciphers);
typedef N_CDECL_PTR(NI, TY210657) (NI a, void* b);
typedef N_CDECL_PTR(void, TY210654) (Sslstruct210405* s, NI mode, TY210657 cb);
struct  Systemerror3429  {
  Exception Sup;
};
struct  Ioerror3431  {
  Systemerror3429 Sup;
};
typedef N_STDCALL_PTR(int, TY210687) (Sslstruct210405* ctx, NCSTRING filename);
typedef N_CDECL_PTR(int, TY210694) (Sslstruct210405* ctx, NCSTRING filename, int typ);
typedef N_CDECL_PTR(int, TY210702) (Sslstruct210405* ctx);
typedef NIM_CHAR TY212423[4001];
struct  Socketimpl212410  {
int fd;
NIM_BOOL isbuffered;
union{
struct {TY212423 buffer;
NI currpos;
NI buflen;
} S1;
} isbufferedU;
NIM_BOOL isssl;
union{
struct {Sslstruct210405* sslhandle;
Sslstruct210405* sslcontext;
NIM_BOOL sslnohandshake;
NIM_BOOL sslhaspeekchar;
NIM_CHAR sslpeekchar;
} S1;
} issslU;
NI32 lasterror;
};
typedef N_CDECL_PTR(Sslstruct210405*, TY210622) (Sslstruct210405* context);
typedef N_CDECL_PTR(int, TY210708) (Sslstruct210405* ssl, int fd);
typedef struct {
N_NIMCALL_PTR(NIM_BOOL, ClPrc) (Exception* e, void* ClEnv);
void* ClEnv;
} TY15611;
struct  TSafePoint  {
TSafePoint* prev;
NI status;
jmp_buf context;
NIM_BOOL hasRaiseAction;
TY15611 raiseAction;
};
typedef NU8 TY212468[16];
typedef NU8 TY212472[4];
struct  Ipaddress212463  {
NU8 family;
union{
struct {TY212468 addressv6;
} S1;
struct {TY212472 addressv4;
} S2;
} familyU;
};
struct  Valueerror3449  {
  Exception Sup;
};
struct  Slice83964  {
NI a;
NI b;
};
typedef N_CDECL_PTR(int, TY210734) (Sslstruct210405* ssl);
typedef N_CDECL_PTR(int, TY210756) (Sslstruct210405* s, int retcode);
struct  Oserror3433  {
  Systemerror3429 Sup;
NI32 errorcode;
};
typedef int TY217627[1];
struct  Timeouterror212418  {
  Exception Sup;
};
typedef N_CDECL_PTR(int, TY210748) (Sslstruct210405* ssl, NCSTRING buf, NI num);
typedef N_CDECL_PTR(int, TY210769) (Sslstruct210405* ssl);
typedef N_CDECL_PTR(int, TY210740) (Sslstruct210405* ssl, void* buf, NI num);
typedef N_CDECL_PTR(void, TY211581) (void);
typedef N_CDECL_PTR(int, TY210715) (Sslstruct210405* ssl);
typedef N_CDECL_PTR(void, TY210628) (Sslstruct210405* ssl);
struct  Sslstruct210405  {
char dummy;
};
typedef NI TY25820[8];
struct  Pagedesc44755  {
Pagedesc44755* next;
NI key;
TY25820 bits;
};
struct  Basechunk25841  {
NI prevsize;
NI size;
NIM_BOOL used;
};
struct  Smallchunk25843  {
  Basechunk25841 Sup;
Smallchunk25843* next;
Smallchunk25843* prev;
Freecell25833* freelist;
NI free;
NI acc;
NF data;
};
struct  Llchunk26604  {
NI size;
NI acc;
Llchunk26604* next;
};
struct  Bigchunk25845  {
  Basechunk25841 Sup;
Bigchunk25845* next;
Bigchunk25845* prev;
NI align;
NF data;
};
struct  Trunk25813  {
Trunk25813* next;
NI key;
TY25820 bits;
};
typedef Avlnode26608* TY26614[2];
struct  Avlnode26608  {
TY26614 link;
NI key;
NI upperbound;
NI level;
};
typedef NIM_CHAR TY105053[256];
struct  Freecell25833  {
Freecell25833* next;
NI zerofield;
};
struct TY215429 {
  TGenericSeq Sup;
  int data[SEQ_DECL_SIZE];
};
N_NIMCALL(void, Cryptomallocinit_211204)(void);
N_NIMCALL(void, raisesslerror_212844)(NimStringDesc* s);
N_NIMCALL(void, nimGCvisit)(void* d, NI op);
N_NIMCALL(void, TMP125)(void* p, NI op);
N_NIMCALL(void*, newObj)(TNimType* typ, NI size);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
static N_INLINE(Cell44747*, usrtocell_48246)(void* usr);
static N_INLINE(void, rtladdzct_49804)(Cell44747* c);
N_NOINLINE(void, addzct_48217)(Cellseq44763* s, Cell44747* c);
N_NIMCALL(void, raiseException)(Exception* e, NCSTRING ename);
N_NIMCALL(void, raiseoserror_114809)(NI32 errorcode);
N_NIMCALL(NI32, oslasterror_114833)(void);
N_NIMCALL(NimStringDesc*, cstrToNimstr)(NCSTRING str);
static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src);
N_NIMCALL(NI, Sslctxsetmode_211424)(Sslstruct210405* ctx, NI mode);
N_NIMCALL(void, loadcertificates_212891)(Sslstruct210405* ctx, NimStringDesc* certfile, NimStringDesc* keyfile);
N_NIMCALL(NIM_BOOL, nosexistsFile)(NimStringDesc* filename);
static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src);
N_NIMCALL(NimStringDesc*, rawNewString)(NI space);
N_NIMCALL(int, newrawsocket_206004)(NU8 domain, NU8 typ, NU8 protocol);
N_NIMCALL(Socketimpl212410*, newsocket_212708)(int fd, NIM_BOOL buffered);
N_NIMCALL(void, TMP294)(void* p, NI op);
N_NIMCALL(struct addrinfo*, getaddrinfo_206408)(NimStringDesc* address, NU16 port, NU8 af, NU8 typ, NU8 prot);
N_NIMCALL(void, dealloc_206621)(struct addrinfo* ai);
N_NIMCALL(NIM_BOOL, isipaddress_212482)(NimStringDesc* addressstr);
static N_INLINE(void, pushSafePoint)(TSafePoint* s);
N_NIMCALL(Ipaddress212463, parseipaddress_212488)(NimStringDesc* addressstr);
N_NIMCALL(NIM_BOOL, contains_96351)(NimStringDesc* s, NIM_CHAR c);
N_NIMCALL(Ipaddress212463, parseipv6address_218967)(NimStringDesc* addressstr);
static N_INLINE(NimStringDesc*, HEX5BHEX5D_83957)(NimStringDesc* s, Slice83964 x);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI start_74843, NI last);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI first, NI last);
static N_INLINE(Slice83964, HEX2EHEX2E_102273)(NI a, NI b);
N_NIMCALL(Ipaddress212463, parseipv4address_218804)(NimStringDesc* addressstr);
static N_INLINE(void, popSafePoint)(void);
N_NIMCALL(NIM_BOOL, isObj)(TNimType* obj, TNimType* subclass);
static N_INLINE(Exception*, getCurrentException)(void);
static N_INLINE(void, popCurrentException)(void);
static N_INLINE(void, asgnRef)(void** dest, void* src);
static N_INLINE(void, incref_50622)(Cell44747* c);
static N_INLINE(NIM_BOOL, canbecycleroot_48267)(Cell44747* c);
static N_INLINE(void, rtladdcycleroot_49023)(Cell44747* c);
N_NOINLINE(void, incl_45465)(Cellset44759* s, Cell44747* cell);
static N_INLINE(void, decref_50204)(Cell44747* c);
N_NIMCALL(void, reraiseException)(void);
N_NIMCALL(NI, Sslsettlsexthostname_211444)(Sslstruct210405* ssl, NCSTRING name);
N_NIMCALL(void, socketerror_213229)(Socketimpl212410* socket, NI err, NIM_BOOL async, NI32 lasterror);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* src);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* dest, NI addlen);
N_NIMCALL(NimStringDesc*, oserrormsg_114620)(NI32 errorcode);
N_NIMCALL(NI32, getsocketerror_213204)(Socketimpl212410* socket);
N_NIMCALL(void, setblocking_208445)(int s, NIM_BOOL blocking);
N_NIMCALL(void, connectasync_217503)(Socketimpl212410* socket, NimStringDesc* name, NU16 port, NU8 af);
N_NIMCALL(void*, newSeq)(TNimType* typ, NI len);
N_NIMCALL(NI, selectwrite_208970)(TY215429** writefds, NI timeout);
N_NIMCALL(void, TMP318)(void* p, NI op);
N_NIMCALL(NIM_BOOL, handshake_215022)(Socketimpl212410* socket);
N_NOINLINE(void, raiseassert_84557)(NimStringDesc* msg);
N_NIMCALL(NI, send_216929)(Socketimpl212410* socket, void* data, NI size);
N_NIMCALL(NIM_BOOL, isdisconnectionerror_212494)(NU8 flags, NI32 lasterror);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* s, NI newlen);
N_NIMCALL(NI, waitfor_216034)(Socketimpl212410* socket, NF* waited, NI timeout, NI size, NimStringDesc* funcname);
N_NIMCALL(NIM_BOOL, hasdatabuffered_215204)(Socketimpl212410* s);
N_NIMCALL(NF, ntepochTime)(void);
N_NIMCALL(NI, select_215410)(Socketimpl212410* readfd, NI timeout);
N_NIMCALL(NI, select_208913)(TY215429** readfds, NI timeout);
static N_INLINE(void, HEX2BHEX3D_100688)(NF* x, NF y);
N_NIMCALL(NI, recv_215634)(Socketimpl212410* socket, void* data, NI size);
N_NIMCALL(NI, readintobuf_215439)(Socketimpl212410* socket, NI32 flags);
N_NIMCALL(NI, peekchar_216645)(Socketimpl212410* socket, NIM_CHAR* c);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* s, NIM_CHAR c);
N_NOCONV(void*, alloc_6001)(NI size);
N_NOCONV(void, dealloc_6048)(void* p);
N_NIMCALL(void, close_206028)(int socket);
STRING_LITERAL(TMP126, "No error reported.", 18);
STRING_LITERAL(TMP129, "", 0);
STRING_LITERAL(TMP131, "Certificate file could not be found: ", 37);
STRING_LITERAL(TMP132, "Key file could not be found: ", 29);
STRING_LITERAL(TMP133, "Verification of private key file failed.", 40);
TNimNode* NimDT_212410_isbuffered[3];
TNimNode* NimDT_212410_isssl[3];
STRING_LITERAL(TMP297, "IP Address string is nil", 24);
STRING_LITERAL(TMP298, "Invalid IP Address", 18);
STRING_LITERAL(TMP299, "Invalid IP Address. Address contains an invalid seperator", 57);
STRING_LITERAL(TMP300, "Invalid IP Address. Address contains more than one \"::\" seperat"
"or", 65);
STRING_LITERAL(TMP301, "Invalid IP Address. The address consists of too many groups", 59);
STRING_LITERAL(TMP302, "Invalid IP Address. Address may not start with \":\"", 50);
STRING_LITERAL(TMP303, "Invalid IP Address. Address may not end with \":\"", 48);
STRING_LITERAL(TMP304, "Invalid IP Address. Value is out of range", 41);
STRING_LITERAL(TMP305, "Invalid IP Address. Address contains an invalid character", 57);
STRING_LITERAL(TMP306, "Invalid IP Address. The address consists of too few groups", 58);
STRING_LITERAL(TMP307, "TLS/SSL connection failed to initiate, socket closed prematurel"
"y.", 65);
STRING_LITERAL(TMP308, "Not enough data on socket.", 26);
STRING_LITERAL(TMP309, "Function for x509 lookup has been called.", 41);
STRING_LITERAL(TMP310, "IO error has occurred ", 22);
STRING_LITERAL(TMP311, "because an EOF was observed that violates the protocol", 54);
STRING_LITERAL(TMP312, "in the BIO layer", 16);
STRING_LITERAL(TMP313, ": ", 2);
STRING_LITERAL(TMP314, ". The OS reports: ", 18);
STRING_LITERAL(TMP315, "Unknown Error", 13);
STRING_LITERAL(TMP316, "No valid socket error code available", 36);
STRING_LITERAL(TMP319, "Call to \'connect\' timed out.", 28);
STRING_LITERAL(TMP320, "Socket is not an SSL socket.", 28);
STRING_LITERAL(TMP322, "handshake(socket) ", 18);
STRING_LITERAL(TMP323, "Could not send all data.", 24);
STRING_LITERAL(TMP331, "Call to \'", 9);
STRING_LITERAL(TMP332, "\' timed out.", 12);
STRING_LITERAL(TMP333, "readLine", 8);
STRING_LITERAL(TMP334, "\015\012", 2);
STRING_LITERAL(TMP349, "skip", 4);
STRING_LITERAL(TMP350, "recv", 4);
extern TY210582 Dl_210581;
extern TY210587 Dl_210586;
extern TY210592 Dl_210591;
extern TY211034 Dl_211033;
extern TY210634 Dl_210633;
extern TY210602 Dl_210601;
extern TNimType NTI3427; /* Exception */
TNimType NTI212205; /* SslError */
TNimType NTI212850; /* ref SslError */
extern Gcheap46616 gch_46648;
extern TY211029 Dl_211028;
extern TY211017 Dl_211016;
extern TY210612 Dl_210611;
extern TY210617 Dl_210616;
extern TY210672 Dl_210671;
extern TY210654 Dl_210653;
extern TNimType NTI212899; /* ref IOError */
extern TNimType NTI3431; /* IOError */
extern TY210687 Dl_210686;
extern TY210694 Dl_210693;
extern TY210702 Dl_210701;
extern int osinvalidsocket_205650;
TNimType NTI212410; /* SocketImpl */
extern TNimType NTI5811; /* cint */
extern TNimType NTI138; /* bool */
extern TNimType NTI147; /* char */
TNimType NTI212423; /* array[0..4000, char] */
extern TNimType NTI108; /* int */
extern TNimType NTI210407; /* SslCtx */
extern TNimType NTI114; /* int32 */
TNimType NTI212412; /* Socket */
extern TY210622 Dl_210621;
extern TY210708 Dl_210707;
extern TSafePoint* exchandler_17043;
extern TNimType NTI21228; /* ref ValueError */
extern TNimType NTI3449; /* ValueError */
extern Exception* currexception_17045;
extern TY210734 Dl_210733;
extern TY210756 Dl_210755;
extern TNimType NTI200404; /* ref OSError */
extern TNimType NTI3433; /* OSError */
extern TNimType NTI215429; /* seq[SocketHandle] */
TNimType NTI212418; /* TimeoutError */
TNimType NTI217645; /* ref TimeoutError */
extern TY210748 Dl_210747;
extern TY210769 Dl_210768;
extern TY210740 Dl_210739;
extern TY211581 Dl_211580;
extern TY210715 Dl_210714;
extern TY210628 Dl_210627;
N_NIMCALL(void, TMP125)(void* p, NI op) {
	Sslerror212205* a;
	a = (Sslerror212205*)p;
	nimGCvisit((void*)(*a).Sup.parent, op);
	nimGCvisit((void*)(*a).Sup.message, op);
	nimGCvisit((void*)(*a).Sup.trace, op);
}

static N_INLINE(Cell44747*, usrtocell_48246)(void* usr) {
	Cell44747* result;
	result = 0;
	result = ((Cell44747*) ((NI)((NU64)(((NI) (usr))) - (NU64)(((NI)sizeof(Cell44747))))));
	return result;
}

static N_INLINE(void, rtladdzct_49804)(Cell44747* c) {
	addzct_48217((&gch_46648.zct), c);
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	Cell44747* c;
	c = usrtocell_48246(p);
	{
		(*c).refcount -= ((NI) 8);
		if (!((NU64)((*c).refcount) < (NU64)(((NI) 8)))) goto LA3;
		rtladdzct_49804(c);
	}
	LA3: ;
}

static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src) {
	{
		Cell44747* c;
		if (!!((src == NIM_NIL))) goto LA3;
		c = usrtocell_48246(src);
		(*c).refcount += ((NI) 8);
	}
	LA3: ;
	{
		Cell44747* c;
		if (!!(((*dest) == NIM_NIL))) goto LA7;
		c = usrtocell_48246((*dest));
		{
			(*c).refcount -= ((NI) 8);
			if (!((NU64)((*c).refcount) < (NU64)(((NI) 8)))) goto LA11;
			rtladdzct_49804(c);
		}
		LA11: ;
	}
	LA7: ;
	(*dest) = src;
}

N_NIMCALL(void, raisesslerror_212844)(NimStringDesc* s) {
	int err;
	NCSTRING errstr;
	Sslerror212205* e_212875;
	{
		Sslerror212205* e_212849;
		NimStringDesc* LOC5;
		if (!!(((s) && (s)->Sup.len == 0))) goto LA3;
		e_212849 = 0;
		e_212849 = (Sslerror212205*) newObj((&NTI212850), sizeof(Sslerror212205));
		(*e_212849).Sup.Sup.m_type = (&NTI212205);
		LOC5 = 0;
		LOC5 = (*e_212849).Sup.message; (*e_212849).Sup.message = copyStringRC1(s);
		if (LOC5) nimGCunrefNoCycle(LOC5);
		raiseException((Exception*)e_212849, "SslError");
	}
	LA3: ;
	err = Dl_211028();
	{
		Sslerror212205* e_212862;
		NimStringDesc* LOC10;
		if (!(err == ((NI32) 0))) goto LA8;
		e_212862 = 0;
		e_212862 = (Sslerror212205*) newObj((&NTI212850), sizeof(Sslerror212205));
		(*e_212862).Sup.Sup.m_type = (&NTI212205);
		LOC10 = 0;
		LOC10 = (*e_212862).Sup.message; (*e_212862).Sup.message = copyStringRC1(((NimStringDesc*) &TMP126));
		if (LOC10) nimGCunrefNoCycle(LOC10);
		raiseException((Exception*)e_212862, "SslError");
	}
	LA8: ;
	{
		NI32 LOC15;
		if (!(err == ((NI32) -1))) goto LA13;
		LOC15 = 0;
		LOC15 = oslasterror_114833();
		raiseoserror_114809(LOC15);
	}
	LA13: ;
	errstr = Dl_211016(err, NIM_NIL);
	e_212875 = 0;
	e_212875 = (Sslerror212205*) newObj((&NTI212850), sizeof(Sslerror212205));
	(*e_212875).Sup.Sup.m_type = (&NTI212205);
	asgnRefNoCycle((void**) (&(*e_212875).Sup.message), cstrToNimstr(errstr));
	raiseException((Exception*)e_212875, "SslError");
}

static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src) {
	memcpy(((NCSTRING) ((&(*dest).data[((*dest).Sup.len)- 0]))), ((NCSTRING) ((*src).data)), (NI)((*src).Sup.len + ((NI) 1)));
	(*dest).Sup.len += (*src).Sup.len;
}

N_NIMCALL(void, loadcertificates_212891)(Sslstruct210405* ctx, NimStringDesc* certfile, NimStringDesc* keyfile) {
	{
		NIM_BOOL LOC3;
		NIM_BOOL LOC5;
		Ioerror3431* e_212898;
		NimStringDesc* LOC8;
		LOC3 = 0;
		LOC3 = !(((certfile) && (certfile)->Sup.len == 0));
		if (!(LOC3)) goto LA4;
		LOC5 = 0;
		LOC5 = nosexistsFile(certfile);
		LOC3 = !(LOC5);
		LA4: ;
		if (!LOC3) goto LA6;
		e_212898 = 0;
		e_212898 = (Ioerror3431*) newObj((&NTI212899), sizeof(Ioerror3431));
		(*e_212898).Sup.Sup.Sup.m_type = (&NTI3431);
		LOC8 = 0;
		LOC8 = rawNewString(certfile->Sup.len + 37);
appendString(LOC8, ((NimStringDesc*) &TMP131));
appendString(LOC8, certfile);
		asgnRefNoCycle((void**) (&(*e_212898).Sup.Sup.message), LOC8);
		raiseException((Exception*)e_212898, "IOError");
	}
	LA6: ;
	{
		NIM_BOOL LOC11;
		NIM_BOOL LOC13;
		Ioerror3431* e_212910;
		NimStringDesc* LOC16;
		LOC11 = 0;
		LOC11 = !(((keyfile) && (keyfile)->Sup.len == 0));
		if (!(LOC11)) goto LA12;
		LOC13 = 0;
		LOC13 = nosexistsFile(keyfile);
		LOC11 = !(LOC13);
		LA12: ;
		if (!LOC11) goto LA14;
		e_212910 = 0;
		e_212910 = (Ioerror3431*) newObj((&NTI212899), sizeof(Ioerror3431));
		(*e_212910).Sup.Sup.Sup.m_type = (&NTI3431);
		LOC16 = 0;
		LOC16 = rawNewString(keyfile->Sup.len + 29);
appendString(LOC16, ((NimStringDesc*) &TMP132));
appendString(LOC16, keyfile);
		asgnRefNoCycle((void**) (&(*e_212910).Sup.Sup.message), LOC16);
		raiseException((Exception*)e_212910, "IOError");
	}
	LA14: ;
	{
		int ret;
		if (!!(((certfile) && (certfile)->Sup.len == 0))) goto LA19;
		ret = Dl_210686(ctx, certfile->data);
		{
			if (!!((ret == ((NI32) 1)))) goto LA23;
			raisesslerror_212844(((NimStringDesc*) &TMP129));
		}
		LA23: ;
	}
	LA19: ;
	{
		if (!!(((keyfile) && (keyfile)->Sup.len == 0))) goto LA27;
		{
			int LOC31;
			LOC31 = 0;
			LOC31 = Dl_210693(ctx, keyfile->data, ((int) 1));
			if (!!((LOC31 == ((NI32) 1)))) goto LA32;
			raisesslerror_212844(((NimStringDesc*) &TMP129));
		}
		LA32: ;
		{
			int LOC36;
			LOC36 = 0;
			LOC36 = Dl_210701(ctx);
			if (!!((LOC36 == ((NI32) 1)))) goto LA37;
			raisesslerror_212844(((NimStringDesc*) &TMP133));
		}
		LA37: ;
	}
	LA27: ;
}

N_NIMCALL(Sslstruct210405*, newcontext_212926)(NU8 protversion, NU8 verifymode, NimStringDesc* certfile, NimStringDesc* keyfile) {
	Sslstruct210405* result;
	Sslstruct210405* newctx;
	NI LOC19;
{	result = 0;
	newctx = 0;
	switch (protversion) {
	case ((NU8) 3):
	{
		Sslstruct210405* LOC2;
		LOC2 = 0;
		LOC2 = Dl_210601();
		newctx = Dl_210633(LOC2);
	}
	break;
	case ((NU8) 0):
	{
		raisesslerror_212844(((NimStringDesc*) &TMP129));
	}
	break;
	case ((NU8) 1):
	{
		Sslstruct210405* LOC5;
		LOC5 = 0;
		LOC5 = Dl_210611();
		newctx = Dl_210633(LOC5);
	}
	break;
	case ((NU8) 2):
	{
		Sslstruct210405* LOC7;
		LOC7 = 0;
		LOC7 = Dl_210616();
		newctx = Dl_210633(LOC7);
	}
	break;
	}
	{
		int LOC10;
		LOC10 = 0;
		LOC10 = Dl_210671(newctx, "ALL");
		if (!!((LOC10 == ((NI32) 1)))) goto LA11;
		raisesslerror_212844(((NimStringDesc*) &TMP129));
	}
	LA11: ;
	switch (verifymode) {
	case ((NU8) 1):
	{
		Dl_210653(newctx, ((NI) 1), NIM_NIL);
	}
	break;
	case ((NU8) 0):
	{
		Dl_210653(newctx, ((NI) 0), NIM_NIL);
	}
	break;
	}
	{
		if (!(newctx == NIM_NIL)) goto LA17;
		raisesslerror_212844(((NimStringDesc*) &TMP129));
	}
	LA17: ;
	LOC19 = 0;
	LOC19 = Sslctxsetmode_211424(newctx, ((NI) 4));
	loadcertificates_212891(newctx, certfile, keyfile);
	result = newctx;
	goto BeforeRet;
	}BeforeRet: ;
	return result;
}
N_NIMCALL(void, TMP294)(void* p, NI op) {
	Socketimpl212410* a;
	NI LOC1;
	a = (Socketimpl212410*)p;
	switch ((*a).isbuffered) {
	case NIM_TRUE:
	LOC1 = 0;
	for (LOC1 = 0; LOC1 < 4001; LOC1++) {
	}
	break;
	case NIM_FALSE:
	break;
	} 
	switch ((*a).isssl) {
	case NIM_TRUE:
	break;
	case NIM_FALSE:
	break;
	} 
}

N_NIMCALL(Socketimpl212410*, newsocket_212708)(int fd, NIM_BOOL buffered) {
	Socketimpl212410* result;
	result = 0;
	result = (Socketimpl212410*) newObj((&NTI212412), sizeof(Socketimpl212410));
	(*result).fd = fd;
	(*result).isbuffered = buffered;
	{
		if (!buffered) goto LA3;
		(*result).isbufferedU.S1.currpos = ((NI) 0);
	}
	LA3: ;
	return result;
}

N_NIMCALL(Socketimpl212410*, newsocket_212830)(NU8 domain, NU8 typ, NU8 protocol, NIM_BOOL buffered) {
	Socketimpl212410* result;
	int fd;
	result = 0;
	fd = newrawsocket_206004(domain, typ, protocol);
	{
		NI32 LOC5;
		if (!(fd == osinvalidsocket_205650)) goto LA3;
		LOC5 = 0;
		LOC5 = oslasterror_114833();
		raiseoserror_114809(LOC5);
	}
	LA3: ;
	result = newsocket_212708(fd, buffered);
	return result;
}

N_NIMCALL(void, wrapsocket_213017)(Sslstruct210405* ctx, Socketimpl212410* socket) {
	(*socket).isssl = NIM_TRUE;
	(*socket).issslU.S1.sslcontext = ctx;
	(*socket).issslU.S1.sslhandle = Dl_210621((*socket).issslU.S1.sslcontext);
	(*socket).issslU.S1.sslnohandshake = NIM_FALSE;
	(*socket).issslU.S1.sslhaspeekchar = NIM_FALSE;
	{
		if (!((*socket).issslU.S1.sslhandle == NIM_NIL)) goto LA3;
		raisesslerror_212844(((NimStringDesc*) &TMP129));
	}
	LA3: ;
	{
		int LOC7;
		LOC7 = 0;
		LOC7 = Dl_210707((*socket).issslU.S1.sslhandle, (*socket).fd);
		if (!!((LOC7 == ((NI32) 1)))) goto LA8;
		raisesslerror_212844(((NimStringDesc*) &TMP129));
	}
	LA8: ;
}

static N_INLINE(void, pushSafePoint)(TSafePoint* s) {
	(*s).hasRaiseAction = NIM_FALSE;
	(*s).prev = exchandler_17043;
	exchandler_17043 = s;
}

static N_INLINE(NimStringDesc*, HEX5BHEX5D_83957)(NimStringDesc* s, Slice83964 x) {
	NimStringDesc* result;
	result = 0;
	result = copyStrLast(s, x.a, x.b);
	return result;
}

static N_INLINE(Slice83964, HEX2EHEX2E_102273)(NI a, NI b) {
	Slice83964 result;
	memset((void*)(&result), 0, sizeof(result));
	result.a = a;
	result.b = b;
	return result;
}

N_NIMCALL(Ipaddress212463, parseipv6address_218967)(NimStringDesc* addressstr) {
	Ipaddress212463 result;
	NI groupcount;
	NI currentgroupstart;
	NU32 currentshort;
	NIM_BOOL seperatorvalid;
	NI dualcolongroup;
	NIM_BOOL lastwascolon;
	NI v4startpos;
	NI bytecount;
	memset((void*)(&result), 0, sizeof(result));
	result.family = ((NU8) 0);
	{
		Valueerror3449* e_218974;
		NimStringDesc* LOC5;
		if (!((addressstr ? addressstr->Sup.len : 0) < ((NI) 2))) goto LA3;
		e_218974 = 0;
		e_218974 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
		(*e_218974).Sup.Sup.m_type = (&NTI3449);
		LOC5 = 0;
		LOC5 = (*e_218974).Sup.message; (*e_218974).Sup.message = copyStringRC1(((NimStringDesc*) &TMP298));
		if (LOC5) nimGCunrefNoCycle(LOC5);
		raiseException((Exception*)e_218974, "ValueError");
	}
	LA3: ;
	groupcount = ((NI) 0);
	currentgroupstart = ((NI) 0);
	currentshort = ((NU32) 0);
	seperatorvalid = NIM_TRUE;
	dualcolongroup = ((NI) -1);
	lastwascolon = NIM_FALSE;
	v4startpos = ((NI) -1);
	bytecount = ((NI) 0);
	{
		NI i_218992;
		NIM_CHAR c_218993;
		NI i_219533;
		i_218992 = 0;
		c_218993 = 0;
		i_219533 = ((NI) 0);
		{
			while (1) {
				if (!(i_219533 < (addressstr ? addressstr->Sup.len : 0))) goto LA8;
				i_218992 = i_219533;
				c_218993 = addressstr->data[i_219533];
				{
					if (!((NU8)(c_218993) == (NU8)(58))) goto LA11;
					{
						Valueerror3449* e_218996;
						NimStringDesc* LOC17;
						if (!!(seperatorvalid)) goto LA15;
						e_218996 = 0;
						e_218996 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_218996).Sup.Sup.m_type = (&NTI3449);
						LOC17 = 0;
						LOC17 = (*e_218996).Sup.message; (*e_218996).Sup.message = copyStringRC1(((NimStringDesc*) &TMP299));
						if (LOC17) nimGCunrefNoCycle(LOC17);
						raiseException((Exception*)e_218996, "ValueError");
					}
					LA15: ;
					{
						if (!lastwascolon) goto LA20;
						{
							Valueerror3449* e_219008;
							NimStringDesc* LOC26;
							if (!!((dualcolongroup == ((NI) -1)))) goto LA24;
							e_219008 = 0;
							e_219008 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219008).Sup.Sup.m_type = (&NTI3449);
							LOC26 = 0;
							LOC26 = (*e_219008).Sup.message; (*e_219008).Sup.message = copyStringRC1(((NimStringDesc*) &TMP300));
							if (LOC26) nimGCunrefNoCycle(LOC26);
							raiseException((Exception*)e_219008, "ValueError");
						}
						LA24: ;
						dualcolongroup = groupcount;
						seperatorvalid = NIM_FALSE;
					}
					goto LA18;
					LA20: ;
					{
						NIM_BOOL LOC28;
						LOC28 = 0;
						LOC28 = !((i_218992 == ((NI) 0)));
						if (!(LOC28)) goto LA29;
						LOC28 = !((i_218992 == (addressstr ? (addressstr->Sup.len-1) : -1)));
						LA29: ;
						if (!LOC28) goto LA30;
						{
							Valueerror3449* e_219020;
							NimStringDesc* LOC36;
							if (!(((NI) 8) <= groupcount)) goto LA34;
							e_219020 = 0;
							e_219020 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219020).Sup.Sup.m_type = (&NTI3449);
							LOC36 = 0;
							LOC36 = (*e_219020).Sup.message; (*e_219020).Sup.message = copyStringRC1(((NimStringDesc*) &TMP301));
							if (LOC36) nimGCunrefNoCycle(LOC36);
							raiseException((Exception*)e_219020, "ValueError");
						}
						LA34: ;
						result.familyU.S1.addressv6[((NI)(groupcount * ((NI) 2)))- 0] = ((NU8) ((NU32)((NU64)(currentshort) >> (NU64)(((NI) 8)))));
						result.familyU.S1.addressv6[((NI)((NI)(groupcount * ((NI) 2)) + ((NI) 1)))- 0] = ((NU8) ((NU32)(currentshort & ((NI) 255))));
						currentshort = ((NU32) 0);
						groupcount += ((NI) 1);
						{
							if (!!((dualcolongroup == ((NI) -1)))) goto LA39;
							seperatorvalid = NIM_FALSE;
						}
						LA39: ;
					}
					goto LA18;
					LA30: ;
					{
						if (!(i_218992 == ((NI) 0))) goto LA42;
						{
							Valueerror3449* e_219063;
							NimStringDesc* LOC48;
							if (!!(((NU8)(addressstr->data[((NI) 1)]) == (NU8)(58)))) goto LA46;
							e_219063 = 0;
							e_219063 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219063).Sup.Sup.m_type = (&NTI3449);
							LOC48 = 0;
							LOC48 = (*e_219063).Sup.message; (*e_219063).Sup.message = copyStringRC1(((NimStringDesc*) &TMP302));
							if (LOC48) nimGCunrefNoCycle(LOC48);
							raiseException((Exception*)e_219063, "ValueError");
						}
						LA46: ;
					}
					goto LA18;
					LA42: ;
					{
						{
							Valueerror3449* e_219075;
							NimStringDesc* LOC54;
							if (!!(((NU8)(addressstr->data[(NI)((addressstr ? (addressstr->Sup.len-1) : -1) - ((NI) 1))]) == (NU8)(58)))) goto LA52;
							e_219075 = 0;
							e_219075 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219075).Sup.Sup.m_type = (&NTI3449);
							LOC54 = 0;
							LOC54 = (*e_219075).Sup.message; (*e_219075).Sup.message = copyStringRC1(((NimStringDesc*) &TMP303));
							if (LOC54) nimGCunrefNoCycle(LOC54);
							raiseException((Exception*)e_219075, "ValueError");
						}
						LA52: ;
					}
					LA18: ;
					lastwascolon = NIM_TRUE;
					currentgroupstart = (NI)(i_218992 + ((NI) 1));
				}
				goto LA9;
				LA11: ;
				{
					if (!((NU8)(c_218993) == (NU8)(46))) goto LA56;
					{
						NIM_BOOL LOC60;
						NIM_BOOL LOC61;
						Valueerror3449* e_219087;
						NimStringDesc* LOC66;
						LOC60 = 0;
						LOC61 = 0;
						LOC61 = (i_218992 < ((NI) 3));
						if (LOC61) goto LA62;
						LOC61 = !(seperatorvalid);
						LA62: ;
						LOC60 = LOC61;
						if (LOC60) goto LA63;
						LOC60 = (((NI) 7) <= groupcount);
						LA63: ;
						if (!LOC60) goto LA64;
						e_219087 = 0;
						e_219087 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_219087).Sup.Sup.m_type = (&NTI3449);
						LOC66 = 0;
						LOC66 = (*e_219087).Sup.message; (*e_219087).Sup.message = copyStringRC1(((NimStringDesc*) &TMP298));
						if (LOC66) nimGCunrefNoCycle(LOC66);
						raiseException((Exception*)e_219087, "ValueError");
					}
					LA64: ;
					v4startpos = currentgroupstart;
					currentshort = ((NU32) 0);
					seperatorvalid = NIM_FALSE;
					goto LA6;
				}
				goto LA9;
				LA56: ;
				{
					if (!(((NU8)(c_218993)) >= ((NU8)(48)) && ((NU8)(c_218993)) <= ((NU8)(57)) || ((NU8)(c_218993)) >= ((NU8)(65)) && ((NU8)(c_218993)) <= ((NU8)(70)) || ((NU8)(c_218993)) >= ((NU8)(97)) && ((NU8)(c_218993)) <= ((NU8)(102)))) goto LA68;
					{
						if (!(((NU8)(c_218993)) >= ((NU8)(48)) && ((NU8)(c_218993)) <= ((NU8)(57)))) goto LA72;
						currentshort = (NU32)((NU32)((NU32)((NU64)(currentshort) << (NU64)(((NI) 4)))) + (NU32)(((NU32) ((NI)(((NI) (((NU8)(c_218993)))) - ((NI) 48))))));
					}
					goto LA70;
					LA72: ;
					{
						NIM_BOOL LOC75;
						LOC75 = 0;
						LOC75 = ((NU8)(97) <= (NU8)(c_218993));
						if (!(LOC75)) goto LA76;
						LOC75 = ((NU8)(c_218993) <= (NU8)(102));
						LA76: ;
						if (!LOC75) goto LA77;
						currentshort = (NU32)((NU64)((NU32)((NU32)((NU32)((NU64)(currentshort) << (NU64)(((NI) 4)))) + (NU32)(((NU32) ((NI)(((NI) (((NU8)(c_218993)))) - ((NI) 97))))))) + (NU64)(((NI) 10)));
					}
					goto LA70;
					LA77: ;
					{
						currentshort = (NU32)((NU64)((NU32)((NU32)((NU32)((NU64)(currentshort) << (NU64)(((NI) 4)))) + (NU32)(((NU32) ((NI)(((NI) (((NU8)(c_218993)))) - ((NI) 65))))))) + (NU64)(((NI) 10)));
					}
					LA70: ;
					{
						Valueerror3449* e_219253;
						NimStringDesc* LOC84;
						if (!((NU32)(((NU32) 65535)) < (NU32)(currentshort))) goto LA82;
						e_219253 = 0;
						e_219253 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_219253).Sup.Sup.m_type = (&NTI3449);
						LOC84 = 0;
						LOC84 = (*e_219253).Sup.message; (*e_219253).Sup.message = copyStringRC1(((NimStringDesc*) &TMP304));
						if (LOC84) nimGCunrefNoCycle(LOC84);
						raiseException((Exception*)e_219253, "ValueError");
					}
					LA82: ;
					lastwascolon = NIM_FALSE;
					seperatorvalid = NIM_TRUE;
				}
				goto LA9;
				LA68: ;
				{
					Valueerror3449* e_219265;
					NimStringDesc* LOC86;
					e_219265 = 0;
					e_219265 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
					(*e_219265).Sup.Sup.m_type = (&NTI3449);
					LOC86 = 0;
					LOC86 = (*e_219265).Sup.message; (*e_219265).Sup.message = copyStringRC1(((NimStringDesc*) &TMP305));
					if (LOC86) nimGCunrefNoCycle(LOC86);
					raiseException((Exception*)e_219265, "ValueError");
				}
				LA9: ;
				i_219533 += ((NI) 1);
			} LA8: ;
		}
	} LA6: ;
	{
		if (!(v4startpos == ((NI) -1))) goto LA89;
		{
			if (!seperatorvalid) goto LA93;
			{
				Valueerror3449* e_219277;
				NimStringDesc* LOC99;
				if (!(((NI) 8) <= groupcount)) goto LA97;
				e_219277 = 0;
				e_219277 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
				(*e_219277).Sup.Sup.m_type = (&NTI3449);
				LOC99 = 0;
				LOC99 = (*e_219277).Sup.message; (*e_219277).Sup.message = copyStringRC1(((NimStringDesc*) &TMP301));
				if (LOC99) nimGCunrefNoCycle(LOC99);
				raiseException((Exception*)e_219277, "ValueError");
			}
			LA97: ;
			result.familyU.S1.addressv6[((NI)(groupcount * ((NI) 2)))- 0] = ((NU8) ((NU32)((NU64)(currentshort) >> (NU64)(((NI) 8)))));
			result.familyU.S1.addressv6[((NI)((NI)(groupcount * ((NI) 2)) + ((NI) 1)))- 0] = ((NU8) ((NU32)(currentshort & ((NI) 255))));
			groupcount += ((NI) 1);
		}
		LA93: ;
	}
	goto LA87;
	LA89: ;
	{
		{
			NI i_219328;
			NIM_CHAR c_219329;
			NimStringDesc* HEX3Atmp_219543;
			Slice83964 LOC102;
			NI i_219546;
			i_219328 = 0;
			c_219329 = 0;
			HEX3Atmp_219543 = 0;
			LOC102 = HEX2EHEX2E_102273(v4startpos, (addressstr ? (addressstr->Sup.len-1) : -1));
			HEX3Atmp_219543 = HEX5BHEX5D_83957(addressstr, LOC102);
			i_219546 = ((NI) 0);
			{
				while (1) {
					if (!(i_219546 < (HEX3Atmp_219543 ? HEX3Atmp_219543->Sup.len : 0))) goto LA104;
					i_219328 = i_219546;
					c_219329 = HEX3Atmp_219543->data[i_219546];
					{
						if (!(((NU8)(c_219329)) >= ((NU8)(48)) && ((NU8)(c_219329)) <= ((NU8)(57)))) goto LA107;
						currentshort = (NU32)((NU32)((NU32)((NU64)(currentshort) * (NU64)(((NI) 10)))) + (NU32)(((NU32) ((NI)(((NI) (((NU8)(c_219329)))) - ((NI) 48))))));
						{
							Valueerror3449* e_219386;
							NimStringDesc* LOC113;
							if (!((NU32)(((NU32) 255)) < (NU32)(currentshort))) goto LA111;
							e_219386 = 0;
							e_219386 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219386).Sup.Sup.m_type = (&NTI3449);
							LOC113 = 0;
							LOC113 = (*e_219386).Sup.message; (*e_219386).Sup.message = copyStringRC1(((NimStringDesc*) &TMP304));
							if (LOC113) nimGCunrefNoCycle(LOC113);
							raiseException((Exception*)e_219386, "ValueError");
						}
						LA111: ;
						seperatorvalid = NIM_TRUE;
					}
					goto LA105;
					LA107: ;
					{
						if (!((NU8)(c_219329) == (NU8)(46))) goto LA115;
						{
							NIM_BOOL LOC119;
							Valueerror3449* e_219398;
							NimStringDesc* LOC123;
							LOC119 = 0;
							LOC119 = !(seperatorvalid);
							if (LOC119) goto LA120;
							LOC119 = (((NI) 3) <= bytecount);
							LA120: ;
							if (!LOC119) goto LA121;
							e_219398 = 0;
							e_219398 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
							(*e_219398).Sup.Sup.m_type = (&NTI3449);
							LOC123 = 0;
							LOC123 = (*e_219398).Sup.message; (*e_219398).Sup.message = copyStringRC1(((NimStringDesc*) &TMP298));
							if (LOC123) nimGCunrefNoCycle(LOC123);
							raiseException((Exception*)e_219398, "ValueError");
						}
						LA121: ;
						result.familyU.S1.addressv6[((NI)((NI)(groupcount * ((NI) 2)) + bytecount))- 0] = ((NU8) (currentshort));
						currentshort = ((NU32) 0);
						bytecount += ((NI) 1);
						seperatorvalid = NIM_FALSE;
					}
					goto LA105;
					LA115: ;
					{
						Valueerror3449* e_219420;
						NimStringDesc* LOC125;
						e_219420 = 0;
						e_219420 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_219420).Sup.Sup.m_type = (&NTI3449);
						LOC125 = 0;
						LOC125 = (*e_219420).Sup.message; (*e_219420).Sup.message = copyStringRC1(((NimStringDesc*) &TMP305));
						if (LOC125) nimGCunrefNoCycle(LOC125);
						raiseException((Exception*)e_219420, "ValueError");
					}
					LA105: ;
					i_219546 += ((NI) 1);
				} LA104: ;
			}
		}
		{
			NIM_BOOL LOC128;
			Valueerror3449* e_219432;
			NimStringDesc* LOC132;
			LOC128 = 0;
			LOC128 = !((bytecount == ((NI) 3)));
			if (LOC128) goto LA129;
			LOC128 = !(seperatorvalid);
			LA129: ;
			if (!LOC128) goto LA130;
			e_219432 = 0;
			e_219432 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
			(*e_219432).Sup.Sup.m_type = (&NTI3449);
			LOC132 = 0;
			LOC132 = (*e_219432).Sup.message; (*e_219432).Sup.message = copyStringRC1(((NimStringDesc*) &TMP298));
			if (LOC132) nimGCunrefNoCycle(LOC132);
			raiseException((Exception*)e_219432, "ValueError");
		}
		LA130: ;
		result.familyU.S1.addressv6[((NI)((NI)(groupcount * ((NI) 2)) + bytecount))- 0] = ((NU8) (currentshort));
		groupcount += ((NI) 2);
	}
	LA87: ;
	{
		Valueerror3449* e_219454;
		NimStringDesc* LOC137;
		if (!(((NI) 8) < groupcount)) goto LA135;
		e_219454 = 0;
		e_219454 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
		(*e_219454).Sup.Sup.m_type = (&NTI3449);
		LOC137 = 0;
		LOC137 = (*e_219454).Sup.message; (*e_219454).Sup.message = copyStringRC1(((NimStringDesc*) &TMP301));
		if (LOC137) nimGCunrefNoCycle(LOC137);
		raiseException((Exception*)e_219454, "ValueError");
	}
	goto LA133;
	LA135: ;
	{
		NI tofill;
		NI toshift;
		if (!(groupcount < ((NI) 8))) goto LA139;
		{
			Valueerror3449* e_219466;
			NimStringDesc* LOC145;
			if (!(dualcolongroup == ((NI) -1))) goto LA143;
			e_219466 = 0;
			e_219466 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
			(*e_219466).Sup.Sup.m_type = (&NTI3449);
			LOC145 = 0;
			LOC145 = (*e_219466).Sup.message; (*e_219466).Sup.message = copyStringRC1(((NimStringDesc*) &TMP306));
			if (LOC145) nimGCunrefNoCycle(LOC145);
			raiseException((Exception*)e_219466, "ValueError");
		}
		LA143: ;
		tofill = (NI)(((NI) 8) - groupcount);
		toshift = (NI)(groupcount - dualcolongroup);
		{
			NI i_219488;
			NI HEX3Atmp_219552;
			NI res_219555;
			i_219488 = 0;
			HEX3Atmp_219552 = 0;
			HEX3Atmp_219552 = (NI)((NI)(((NI) 2) * toshift) - ((NI) 1));
			res_219555 = ((NI) 0);
			{
				while (1) {
					if (!(res_219555 <= HEX3Atmp_219552)) goto LA148;
					i_219488 = res_219555;
					result.familyU.S1.addressv6[((NI)(((NI) 15) - i_219488))- 0] = result.familyU.S1.addressv6[((NI)((NI)((NI)(groupcount * ((NI) 2)) - i_219488) - ((NI) 1)))- 0];
					res_219555 += ((NI) 1);
				} LA148: ;
			}
		}
		{
			NI i_219501;
			NI HEX3Atmp_219560;
			NI res_219563;
			i_219501 = 0;
			HEX3Atmp_219560 = 0;
			HEX3Atmp_219560 = (NI)((NI)(((NI) 2) * tofill) - ((NI) 1));
			res_219563 = ((NI) 0);
			{
				while (1) {
					if (!(res_219563 <= HEX3Atmp_219560)) goto LA151;
					i_219501 = res_219563;
					result.familyU.S1.addressv6[((NI)((NI)(dualcolongroup * ((NI) 2)) + i_219501))- 0] = ((NU8) 0);
					res_219563 += ((NI) 1);
				} LA151: ;
			}
		}
	}
	goto LA133;
	LA139: ;
	{
		Valueerror3449* e_219505;
		NimStringDesc* LOC155;
		if (!!((dualcolongroup == ((NI) -1)))) goto LA153;
		e_219505 = 0;
		e_219505 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
		(*e_219505).Sup.Sup.m_type = (&NTI3449);
		LOC155 = 0;
		LOC155 = (*e_219505).Sup.message; (*e_219505).Sup.message = copyStringRC1(((NimStringDesc*) &TMP301));
		if (LOC155) nimGCunrefNoCycle(LOC155);
		raiseException((Exception*)e_219505, "ValueError");
	}
	goto LA133;
	LA153: ;
	LA133: ;
	return result;
}

N_NIMCALL(Ipaddress212463, parseipv4address_218804)(NimStringDesc* addressstr) {
	Ipaddress212463 result;
	NI bytecount;
	NU16 currentbyte;
	NIM_BOOL seperatorvalid;
	memset((void*)(&result), 0, sizeof(result));
	bytecount = ((NI) 0);
	currentbyte = ((NU16) 0);
	seperatorvalid = NIM_FALSE;
	result.family = ((NU8) 1);
	{
		NI i_218822;
		NI HEX3Atmp_218943;
		NI res_218946;
		i_218822 = 0;
		HEX3Atmp_218943 = 0;
		HEX3Atmp_218943 = (addressstr ? (addressstr->Sup.len-1) : -1);
		res_218946 = ((NI) 0);
		{
			while (1) {
				if (!(res_218946 <= HEX3Atmp_218943)) goto LA3;
				i_218822 = res_218946;
				{
					if (!(((NU8)(addressstr->data[i_218822])) >= ((NU8)(48)) && ((NU8)(addressstr->data[i_218822])) <= ((NU8)(57)))) goto LA6;
					currentbyte = (NU16)((NU16)((NU16)((NU64)(currentbyte) * (NU64)(((NI) 10)))) + (NU16)(((NU16) ((NI)(((NI) (((NU8)(addressstr->data[i_218822])))) - ((NI) 48))))));
					{
						Valueerror3449* e_218879;
						NimStringDesc* LOC12;
						if (!((NU16)(((NU16) 255)) < (NU16)(currentbyte))) goto LA10;
						e_218879 = 0;
						e_218879 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_218879).Sup.Sup.m_type = (&NTI3449);
						LOC12 = 0;
						LOC12 = (*e_218879).Sup.message; (*e_218879).Sup.message = copyStringRC1(((NimStringDesc*) &TMP304));
						if (LOC12) nimGCunrefNoCycle(LOC12);
						raiseException((Exception*)e_218879, "ValueError");
					}
					LA10: ;
					seperatorvalid = NIM_TRUE;
				}
				goto LA4;
				LA6: ;
				{
					if (!((NU8)(addressstr->data[i_218822]) == (NU8)(46))) goto LA14;
					{
						NIM_BOOL LOC18;
						Valueerror3449* e_218891;
						NimStringDesc* LOC22;
						LOC18 = 0;
						LOC18 = !(seperatorvalid);
						if (LOC18) goto LA19;
						LOC18 = (((NI) 3) <= bytecount);
						LA19: ;
						if (!LOC18) goto LA20;
						e_218891 = 0;
						e_218891 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
						(*e_218891).Sup.Sup.m_type = (&NTI3449);
						LOC22 = 0;
						LOC22 = (*e_218891).Sup.message; (*e_218891).Sup.message = copyStringRC1(((NimStringDesc*) &TMP301));
						if (LOC22) nimGCunrefNoCycle(LOC22);
						raiseException((Exception*)e_218891, "ValueError");
					}
					LA20: ;
					result.familyU.S2.addressv4[(bytecount)- 0] = ((NU8) (currentbyte));
					currentbyte = ((NU16) 0);
					bytecount += ((NI) 1);
					seperatorvalid = NIM_FALSE;
				}
				goto LA4;
				LA14: ;
				{
					Valueerror3449* e_218913;
					NimStringDesc* LOC24;
					e_218913 = 0;
					e_218913 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
					(*e_218913).Sup.Sup.m_type = (&NTI3449);
					LOC24 = 0;
					LOC24 = (*e_218913).Sup.message; (*e_218913).Sup.message = copyStringRC1(((NimStringDesc*) &TMP305));
					if (LOC24) nimGCunrefNoCycle(LOC24);
					raiseException((Exception*)e_218913, "ValueError");
				}
				LA4: ;
				res_218946 += ((NI) 1);
			} LA3: ;
		}
	}
	{
		NIM_BOOL LOC27;
		Valueerror3449* e_218925;
		NimStringDesc* LOC31;
		LOC27 = 0;
		LOC27 = !((bytecount == ((NI) 3)));
		if (LOC27) goto LA28;
		LOC27 = !(seperatorvalid);
		LA28: ;
		if (!LOC27) goto LA29;
		e_218925 = 0;
		e_218925 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
		(*e_218925).Sup.Sup.m_type = (&NTI3449);
		LOC31 = 0;
		LOC31 = (*e_218925).Sup.message; (*e_218925).Sup.message = copyStringRC1(((NimStringDesc*) &TMP298));
		if (LOC31) nimGCunrefNoCycle(LOC31);
		raiseException((Exception*)e_218925, "ValueError");
	}
	LA29: ;
	result.familyU.S2.addressv4[(bytecount)- 0] = ((NU8) (currentbyte));
	return result;
}

N_NIMCALL(Ipaddress212463, parseipaddress_212488)(NimStringDesc* addressstr) {
	Ipaddress212463 result;
{	memset((void*)(&result), 0, sizeof(result));
	{
		Valueerror3449* e_219616;
		NimStringDesc* LOC5;
		if (!(addressstr == NIM_NIL)) goto LA3;
		e_219616 = 0;
		e_219616 = (Valueerror3449*) newObj((&NTI21228), sizeof(Valueerror3449));
		(*e_219616).Sup.Sup.m_type = (&NTI3449);
		LOC5 = 0;
		LOC5 = (*e_219616).Sup.message; (*e_219616).Sup.message = copyStringRC1(((NimStringDesc*) &TMP297));
		if (LOC5) nimGCunrefNoCycle(LOC5);
		raiseException((Exception*)e_219616, "ValueError");
	}
	LA3: ;
	{
		NIM_BOOL LOC8;
		LOC8 = 0;
		LOC8 = contains_96351(addressstr, 58);
		if (!LOC8) goto LA9;
		result = parseipv6address_218967(addressstr);
		goto BeforeRet;
	}
	goto LA6;
	LA9: ;
	{
		result = parseipv4address_218804(addressstr);
		goto BeforeRet;
	}
	LA6: ;
	}BeforeRet: ;
	return result;
}

static N_INLINE(void, popSafePoint)(void) {
	exchandler_17043 = (*exchandler_17043).prev;
}

static N_INLINE(Exception*, getCurrentException)(void) {
	Exception* result;
	result = 0;
	result = currexception_17045;
	return result;
}

static N_INLINE(NIM_BOOL, canbecycleroot_48267)(Cell44747* c) {
	NIM_BOOL result;
	result = 0;
	result = !((((*(*c).typ).flags &(1<<((((NU8) 1))&7)))!=0));
	return result;
}

static N_INLINE(void, rtladdcycleroot_49023)(Cell44747* c) {
	{
		if (!!((((NI) ((NI)((*c).refcount & ((NI) 3)))) == ((NI) 3)))) goto LA3;
		(*c).refcount = (NI)((NI)((*c).refcount & ((NI) -4)) | ((NI) 3));
		incl_45465((&gch_46648.cycleroots), c);
	}
	LA3: ;
}

static N_INLINE(void, incref_50622)(Cell44747* c) {
	(*c).refcount = (NI)((NU64)((*c).refcount) + (NU64)(((NI) 8)));
	{
		NIM_BOOL LOC3;
		LOC3 = 0;
		LOC3 = canbecycleroot_48267(c);
		if (!LOC3) goto LA4;
		rtladdcycleroot_49023(c);
	}
	LA4: ;
}

static N_INLINE(void, decref_50204)(Cell44747* c) {
	{
		(*c).refcount -= ((NI) 8);
		if (!((NU64)((*c).refcount) < (NU64)(((NI) 8)))) goto LA3;
		rtladdzct_49804(c);
	}
	goto LA1;
	LA3: ;
	{
		NIM_BOOL LOC6;
		LOC6 = 0;
		LOC6 = canbecycleroot_48267(c);
		if (!LOC6) goto LA7;
		rtladdcycleroot_49023(c);
	}
	goto LA1;
	LA7: ;
	LA1: ;
}

static N_INLINE(void, asgnRef)(void** dest, void* src) {
	{
		Cell44747* LOC5;
		if (!!((src == NIM_NIL))) goto LA3;
		LOC5 = 0;
		LOC5 = usrtocell_48246(src);
		incref_50622(LOC5);
	}
	LA3: ;
	{
		Cell44747* LOC10;
		if (!!(((*dest) == NIM_NIL))) goto LA8;
		LOC10 = 0;
		LOC10 = usrtocell_48246((*dest));
		decref_50204(LOC10);
	}
	LA8: ;
	(*dest) = src;
}

static N_INLINE(void, popCurrentException)(void) {
	asgnRef((void**) (&currexception_17045), (*currexception_17045).parent);
}

N_NIMCALL(NIM_BOOL, isipaddress_212482)(NimStringDesc* addressstr) {
	NIM_BOOL result;
	TSafePoint TMP296;
{	result = 0;
	pushSafePoint(&TMP296);
	TMP296.status = setjmp(TMP296.context);
	if (TMP296.status == 0) {
		Ipaddress212463 LOC2;
		LOC2 = parseipaddress_212488(addressstr);
		popSafePoint();
	}
	else {
		popSafePoint();
		if (isObj(getCurrentException()->Sup.m_type, (&NTI3449))) {
			TMP296.status = 0;
			result = NIM_FALSE;
			popCurrentException();
			goto BeforeRet;
			popCurrentException();
		}
	}
	if (TMP296.status != 0) reraiseException();
	result = NIM_TRUE;
	goto BeforeRet;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(NI32, getsocketerror_213204)(Socketimpl212410* socket) {
	NI32 result;
	result = 0;
	result = oslasterror_114833();
	{
		if (!(result == ((NI32) 0))) goto LA3;
		result = (*socket).lasterror;
	}
	LA3: ;
	{
		Oserror3433* e_213212;
		NimStringDesc* LOC9;
		if (!(result == ((NI32) 0))) goto LA7;
		e_213212 = 0;
		e_213212 = (Oserror3433*) newObj((&NTI200404), sizeof(Oserror3433));
		(*e_213212).Sup.Sup.Sup.m_type = (&NTI3433);
		LOC9 = 0;
		LOC9 = (*e_213212).Sup.Sup.message; (*e_213212).Sup.Sup.message = copyStringRC1(((NimStringDesc*) &TMP316));
		if (LOC9) nimGCunrefNoCycle(LOC9);
		raiseException((Exception*)e_213212, "OSError");
	}
	LA7: ;
	return result;
}

N_NIMCALL(void, socketerror_213229)(Socketimpl212410* socket, NI err, NIM_BOOL async, NI32 lasterror) {
{	{
		if (!(*socket).isssl) goto LA3;
		{
			int ret;
			if (!(err <= ((NI) 0))) goto LA7;
			ret = Dl_210755((*socket).issslU.S1.sslhandle, ((int) (err)));
			switch (ret) {
			case ((NI) 6):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP307));
			}
			break;
			case ((NI) 7):
			case ((NI) 8):
			{
				{
					if (!async) goto LA13;
					goto BeforeRet;
				}
				goto LA11;
				LA13: ;
				{
					raisesslerror_212844(((NimStringDesc*) &TMP308));
				}
				LA11: ;
			}
			break;
			case ((NI) 3):
			case ((NI) 2):
			{
				{
					if (!async) goto LA19;
					goto BeforeRet;
				}
				goto LA17;
				LA19: ;
				{
					raisesslerror_212844(((NimStringDesc*) &TMP308));
				}
				LA17: ;
			}
			break;
			case ((NI) 4):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP309));
			}
			break;
			case ((NI) 5):
			{
				NimStringDesc* errstr_213405;
				int sslerr;
				NimStringDesc* osmsg;
				NI32 LOC38;
				Oserror3433* e_213411;
				NimStringDesc* LOC44;
				errstr_213405 = copyString(((NimStringDesc*) &TMP310));
				sslerr = Dl_211028();
				{
					NIM_BOOL LOC26;
					LOC26 = 0;
					LOC26 = (sslerr == ((NI32) 0));
					if (!(LOC26)) goto LA27;
					LOC26 = (err == ((NI) 0));
					LA27: ;
					if (!LOC26) goto LA28;
					errstr_213405 = resizeString(errstr_213405, 54);
appendString(errstr_213405, ((NimStringDesc*) &TMP311));
				}
				goto LA24;
				LA28: ;
				{
					NIM_BOOL LOC31;
					LOC31 = 0;
					LOC31 = (sslerr == ((NI32) 0));
					if (!(LOC31)) goto LA32;
					LOC31 = (err == ((NI) -1));
					LA32: ;
					if (!LOC31) goto LA33;
					errstr_213405 = resizeString(errstr_213405, 16);
appendString(errstr_213405, ((NimStringDesc*) &TMP312));
				}
				goto LA24;
				LA33: ;
				{
					NimStringDesc* errstr;
					NCSTRING LOC36;
					NimStringDesc* LOC37;
					LOC36 = 0;
					LOC36 = Dl_211016(sslerr, NIM_NIL);
					errstr = cstrToNimstr(LOC36);
					LOC37 = 0;
					LOC37 = rawNewString(errstr->Sup.len + errstr->Sup.len + 2);
appendString(LOC37, errstr);
appendString(LOC37, ((NimStringDesc*) &TMP313));
appendString(LOC37, errstr);
					raisesslerror_212844(LOC37);
				}
				LA24: ;
				LOC38 = 0;
				LOC38 = oslasterror_114833();
				osmsg = oserrormsg_114620(LOC38);
				{
					NimStringDesc* LOC43;
					if (!!(((osmsg) && (osmsg)->Sup.len == 0))) goto LA41;
					LOC43 = 0;
					LOC43 = rawNewString(osmsg->Sup.len + 18);
appendString(LOC43, ((NimStringDesc*) &TMP314));
appendString(LOC43, osmsg);
					errstr_213405 = resizeString(errstr_213405, LOC43->Sup.len + 0);
appendString(errstr_213405, LOC43);
				}
				LA41: ;
				e_213411 = 0;
				e_213411 = (Oserror3433*) newObj((&NTI200404), sizeof(Oserror3433));
				(*e_213411).Sup.Sup.Sup.m_type = (&NTI3433);
				LOC44 = 0;
				LOC44 = (*e_213411).Sup.Sup.message; (*e_213411).Sup.Sup.message = copyStringRC1(errstr_213405);
				if (LOC44) nimGCunrefNoCycle(LOC44);
				raiseException((Exception*)e_213411, "OSError");
			}
			break;
			case ((NI) 1):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP129));
			}
			break;
			default:
			{
				raisesslerror_212844(((NimStringDesc*) &TMP315));
			}
			break;
			}
		}
		LA7: ;
	}
	LA3: ;
	{
		NIM_BOOL LOC49;
		NI32 laste;
		LOC49 = 0;
		LOC49 = (err == ((NI) -1));
		if (!(LOC49)) goto LA50;
		LOC49 = !((*socket).isssl);
		LA50: ;
		if (!LOC49) goto LA51;
		{
			if (!(((NI) (lasterror)) == ((NI) -1))) goto LA55;
			laste = getsocketerror_213204(socket);
		}
		goto LA53;
		LA55: ;
		{
			laste = lasterror;
		}
		LA53: ;
		{
			if (!async) goto LA60;
			{
				NIM_BOOL LOC64;
				LOC64 = 0;
				LOC64 = (laste == EAGAIN);
				if (LOC64) goto LA65;
				LOC64 = (laste == EWOULDBLOCK);
				LA65: ;
				if (!LOC64) goto LA66;
				goto BeforeRet;
			}
			goto LA62;
			LA66: ;
			{
				raiseoserror_114809(laste);
			}
			LA62: ;
		}
		goto LA58;
		LA60: ;
		{
			raiseoserror_114809(laste);
		}
		LA58: ;
	}
	LA51: ;
	}BeforeRet: ;
}

N_NIMCALL(void, connect_214853)(Socketimpl212410* socket, NimStringDesc* address, NU16 port, NU8 af) {
	struct addrinfo* ailist;
	NIM_BOOL success;
	NI32 lasterror;
	struct addrinfo* it;
	ailist = getaddrinfo_206408(address, port, af, ((NU8) 1), ((NU8) 6));
	success = NIM_FALSE;
	lasterror = 0;
	it = ailist;
	{
		while (1) {
			if (!!((it == NIM_NIL))) goto LA2;
			{
				int LOC5;
				LOC5 = 0;
				LOC5 = connect((*socket).fd, (*it).ai_addr, (*it).ai_addrlen);
				if (!(LOC5 == ((NI32) 0))) goto LA6;
				success = NIM_TRUE;
				goto LA1;
			}
			goto LA3;
			LA6: ;
			{
				lasterror = oslasterror_114833();
			}
			LA3: ;
			it = (*it).ai_next;
		} LA2: ;
	} LA1: ;
	dealloc_206621(ailist);
	{
		if (!!(success)) goto LA11;
		raiseoserror_114809(lasterror);
	}
	LA11: ;
	{
		int ret;
		if (!(*socket).isssl) goto LA15;
		{
			NIM_BOOL LOC19;
			NI LOC22;
			LOC19 = 0;
			LOC19 = isipaddress_212482(address);
			if (!!(LOC19)) goto LA20;
			LOC22 = 0;
			LOC22 = Sslsettlsexthostname_211444((*socket).issslU.S1.sslhandle, address->data);
		}
		LA20: ;
		ret = Dl_210733((*socket).issslU.S1.sslhandle);
		socketerror_213229(socket, ((NI) (ret)), NIM_FALSE, ((NI32) -1));
	}
	LA15: ;
}

N_NIMCALL(void, connectasync_217503)(Socketimpl212410* socket, NimStringDesc* name, NU16 port, NU8 af) {
	struct addrinfo* ailist;
	NIM_BOOL success;
	NI32 lasterror;
	struct addrinfo* it;
	ailist = getaddrinfo_206408(name, port, af, ((NU8) 1), ((NU8) 6));
	success = NIM_FALSE;
	lasterror = 0;
	it = ailist;
	{
		while (1) {
			int ret;
			if (!!((it == NIM_NIL))) goto LA2;
			ret = connect((*socket).fd, (*it).ai_addr, (*it).ai_addrlen);
			{
				if (!(ret == ((NI32) 0))) goto LA5;
				success = NIM_TRUE;
				goto LA1;
			}
			goto LA3;
			LA5: ;
			{
				lasterror = oslasterror_114833();
				{
					NIM_BOOL LOC10;
					LOC10 = 0;
					LOC10 = (lasterror == EINTR);
					if (LOC10) goto LA11;
					LOC10 = (lasterror == EINPROGRESS);
					LA11: ;
					if (!LOC10) goto LA12;
					success = NIM_TRUE;
					goto LA1;
				}
				LA12: ;
			}
			LA3: ;
			it = (*it).ai_next;
		} LA2: ;
	} LA1: ;
	dealloc_206621(ailist);
	{
		if (!!(success)) goto LA16;
		raiseoserror_114809(lasterror);
	}
	LA16: ;
}
N_NIMCALL(void, TMP318)(void* p, NI op) {
	Timeouterror212418* a;
	a = (Timeouterror212418*)p;
	nimGCvisit((void*)(*a).Sup.parent, op);
	nimGCvisit((void*)(*a).Sup.message, op);
	nimGCvisit((void*)(*a).Sup.trace, op);
}

N_NIMCALL(NIM_BOOL, handshake_215022)(Socketimpl212410* socket) {
	NIM_BOOL result;
{	result = 0;
	result = NIM_TRUE;
	{
		int ret;
		if (!(*socket).isssl) goto LA3;
		ret = Dl_210733((*socket).issslU.S1.sslhandle);
		{
			int errret;
			if (!(ret <= ((NI32) 0))) goto LA7;
			errret = Dl_210755((*socket).issslU.S1.sslhandle, ret);
			switch (errret) {
			case ((NI) 6):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP307));
			}
			break;
			case ((NI) 7):
			case ((NI) 8):
			case ((NI) 2):
			case ((NI) 3):
			{
				result = NIM_FALSE;
				goto BeforeRet;
			}
			break;
			case ((NI) 4):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP309));
			}
			break;
			case ((NI) 5):
			case ((NI) 1):
			{
				raisesslerror_212844(((NimStringDesc*) &TMP129));
			}
			break;
			default:
			{
				raisesslerror_212844(((NimStringDesc*) &TMP315));
			}
			break;
			}
		}
		LA7: ;
		(*socket).issslU.S1.sslnohandshake = NIM_FALSE;
	}
	goto LA1;
	LA3: ;
	{
		raisesslerror_212844(((NimStringDesc*) &TMP320));
	}
	LA1: ;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, connect_217618)(Socketimpl212410* socket, NimStringDesc* address, NU16 port, NI timeout, NU8 af) {
	TY215429* s;
	TY217627 LOC1;
	setblocking_208445((*socket).fd, NIM_FALSE);
	connectasync_217503(socket, address, port, af);
	s = (TY215429*) newSeq((&NTI215429), 1);
	LOC1[0] = (*socket).fd;
	s->data[0] = LOC1[0];
	{
		NI LOC4;
		Timeouterror212418* e_217644;
		NimStringDesc* LOC7;
		LOC4 = 0;
		LOC4 = selectwrite_208970((&s), timeout);
		if (!!((LOC4 == ((NI) 1)))) goto LA5;
		e_217644 = 0;
		e_217644 = (Timeouterror212418*) newObj((&NTI217645), sizeof(Timeouterror212418));
		(*e_217644).Sup.Sup.m_type = (&NTI212418);
		LOC7 = 0;
		LOC7 = (*e_217644).Sup.message; (*e_217644).Sup.message = copyStringRC1(((NimStringDesc*) &TMP319));
		if (LOC7) nimGCunrefNoCycle(LOC7);
		raiseException((Exception*)e_217644, "TimeoutError");
	}
	goto LA2;
	LA5: ;
	{
		{
			if (!(*socket).isssl) goto LA11;
			setblocking_208445((*socket).fd, NIM_TRUE);
			{
				NIM_BOOL LOC15;
				LOC15 = 0;
				LOC15 = handshake_215022(socket);
				if (!!(LOC15)) goto LA16;
				raiseassert_84557(((NimStringDesc*) &TMP322));
			}
			LA16: ;
		}
		LA11: ;
	}
	LA2: ;
	setblocking_208445((*socket).fd, NIM_TRUE);
}

N_NIMCALL(NI, send_216929)(Socketimpl212410* socket, void* data, NI size) {
	NI result;
{	result = 0;
	{
		int LOC5;
		if (!(*socket).isssl) goto LA3;
		LOC5 = 0;
		LOC5 = Dl_210747((*socket).issslU.S1.sslhandle, ((NCSTRING) (data)), size);
		result = ((NI) (LOC5));
		goto BeforeRet;
	}
	LA3: ;
	result = send((*socket).fd, data, size, MSG_NOSIGNAL);
	}BeforeRet: ;
	return result;
}

N_NIMCALL(NIM_BOOL, isdisconnectionerror_212494)(NU8 flags, NI32 lasterror) {
	NIM_BOOL result;
	NIM_BOOL LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = ((flags &(1<<((((NU8) 1))&7)))!=0);
	if (!(LOC1)) goto LA2;
	LOC1 = (lasterror == ((NI) (ECONNRESET)) || lasterror == ((NI) (EPIPE)) || lasterror == ((NI) (ENETRESET)));
	LA2: ;
	result = LOC1;
	return result;
}

N_NIMCALL(void, send_217409)(Socketimpl212410* socket, NimStringDesc* data, NU8 flags) {
	NI sent;
{	sent = send_216929(socket, ((void*) (data->data)), (data ? data->Sup.len : 0));
	{
		NI32 lasterror;
		if (!(sent < ((NI) 0))) goto LA3;
		lasterror = oslasterror_114833();
		{
			NIM_BOOL LOC7;
			LOC7 = 0;
			LOC7 = isdisconnectionerror_212494(flags, lasterror);
			if (!LOC7) goto LA8;
			goto BeforeRet;
		}
		LA8: ;
		socketerror_213229(socket, ((NI) -1), NIM_FALSE, lasterror);
	}
	LA3: ;
	{
		Oserror3433* e_217420;
		NimStringDesc* LOC14;
		if (!!((sent == (data ? data->Sup.len : 0)))) goto LA12;
		e_217420 = 0;
		e_217420 = (Oserror3433*) newObj((&NTI200404), sizeof(Oserror3433));
		(*e_217420).Sup.Sup.Sup.m_type = (&NTI3433);
		LOC14 = 0;
		LOC14 = (*e_217420).Sup.Sup.message; (*e_217420).Sup.Sup.message = copyStringRC1(((NimStringDesc*) &TMP323));
		if (LOC14) nimGCunrefNoCycle(LOC14);
		raiseException((Exception*)e_217420, "OSError");
	}
	LA12: ;
	}BeforeRet: ;
}

N_NIMCALL(NIM_BOOL, hasdatabuffered_215204)(Socketimpl212410* s) {
	NIM_BOOL result;
	result = 0;
	result = NIM_FALSE;
	{
		NIM_BOOL LOC5;
		if (!(*s).isbuffered) goto LA3;
		LOC5 = 0;
		LOC5 = (((NI) 0) < (*s).isbufferedU.S1.buflen);
		if (!(LOC5)) goto LA6;
		LOC5 = !(((*s).isbufferedU.S1.currpos == (*s).isbufferedU.S1.buflen));
		LA6: ;
		result = LOC5;
	}
	LA3: ;
	{
		NIM_BOOL LOC9;
		LOC9 = 0;
		LOC9 = (*s).isssl;
		if (!(LOC9)) goto LA10;
		LOC9 = !(result);
		LA10: ;
		if (!LOC9) goto LA11;
		result = (*s).issslU.S1.sslhaspeekchar;
	}
	LA11: ;
	return result;
}

N_NIMCALL(NI, select_215410)(Socketimpl212410* readfd, NI timeout) {
	NI result;
	TY215429* fds;
	TY217627 LOC6;
{	result = 0;
	{
		NIM_BOOL LOC3;
		LOC3 = 0;
		LOC3 = hasdatabuffered_215204(readfd);
		if (!LOC3) goto LA4;
		result = ((NI) 1);
		goto BeforeRet;
	}
	LA4: ;
	fds = (TY215429*) newSeq((&NTI215429), 1);
	LOC6[0] = (*readfd).fd;
	fds->data[0] = LOC6[0];
	result = select_208913((&fds), timeout);
	}BeforeRet: ;
	return result;
}

static N_INLINE(void, HEX2BHEX3D_100688)(NF* x, NF y) {
	(*x) = ((NF)((*x)) + (NF)(y));
}

N_NIMCALL(NI, waitfor_216034)(Socketimpl212410* socket, NF* waited, NI timeout, NI size, NimStringDesc* funcname) {
	NI result;
{	result = 0;
	result = ((NI) 1);
	{
		if (!(size <= ((NI) 0))) goto LA3;
	}
	LA3: ;
	{
		if (!(timeout == ((NI) -1))) goto LA7;
		result = size;
		goto BeforeRet;
	}
	LA7: ;
	{
		NIM_BOOL LOC11;
		NIM_BOOL LOC12;
		LOC11 = 0;
		LOC12 = 0;
		LOC12 = (*socket).isbuffered;
		if (!(LOC12)) goto LA13;
		LOC12 = !(((*socket).isbufferedU.S1.buflen == ((NI) 0)));
		LA13: ;
		LOC11 = LOC12;
		if (!(LOC11)) goto LA14;
		LOC11 = !(((*socket).isbufferedU.S1.buflen == (*socket).isbufferedU.S1.currpos));
		LA14: ;
		if (!LOC11) goto LA15;
		result = (NI)((*socket).isbufferedU.S1.buflen - (*socket).isbufferedU.S1.currpos);
		result = ((result <= size) ? result : size);
	}
	goto LA9;
	LA15: ;
	{
		NF starttime;
		NI selret;
		NF LOC46;
		{
			Timeouterror212418* e_216213;
			NimStringDesc* LOC22;
			if (!((NI)(timeout - ((NI) (((NF)((*waited)) * (NF)(1.0000000000000000e+03))))) < ((NI) 1))) goto LA20;
			e_216213 = 0;
			e_216213 = (Timeouterror212418*) newObj((&NTI217645), sizeof(Timeouterror212418));
			(*e_216213).Sup.Sup.m_type = (&NTI212418);
			LOC22 = 0;
			LOC22 = rawNewString(funcname->Sup.len + 21);
appendString(LOC22, ((NimStringDesc*) &TMP331));
appendString(LOC22, funcname);
appendString(LOC22, ((NimStringDesc*) &TMP332));
			asgnRefNoCycle((void**) (&(*e_216213).Sup.message), LOC22);
			raiseException((Exception*)e_216213, "TimeoutError");
		}
		LA20: ;
		{
			int sslpending;
			if (!(*socket).isssl) goto LA25;
			{
				NIM_BOOL LOC29;
				LOC29 = 0;
				LOC29 = hasdatabuffered_215204(socket);
				if (!LOC29) goto LA30;
				result = ((NI) 1);
				goto BeforeRet;
			}
			LA30: ;
			sslpending = Dl_210768((*socket).issslU.S1.sslhandle);
			{
				if (!!((sslpending == ((NI32) 0)))) goto LA34;
				result = ((NI) (sslpending));
				goto BeforeRet;
			}
			LA34: ;
		}
		LA25: ;
		starttime = ntepochTime();
		selret = select_215410(socket, (NI)(timeout - ((NI) (((NF)((*waited)) * (NF)(1.0000000000000000e+03))))));
		{
			NI32 LOC40;
			if (!(selret < ((NI) 0))) goto LA38;
			LOC40 = 0;
			LOC40 = oslasterror_114833();
			raiseoserror_114809(LOC40);
		}
		LA38: ;
		{
			Timeouterror212418* e_216412;
			NimStringDesc* LOC45;
			if (!!((selret == ((NI) 1)))) goto LA43;
			e_216412 = 0;
			e_216412 = (Timeouterror212418*) newObj((&NTI217645), sizeof(Timeouterror212418));
			(*e_216412).Sup.Sup.m_type = (&NTI212418);
			LOC45 = 0;
			LOC45 = rawNewString(funcname->Sup.len + 21);
appendString(LOC45, ((NimStringDesc*) &TMP331));
appendString(LOC45, funcname);
appendString(LOC45, ((NimStringDesc*) &TMP332));
			asgnRefNoCycle((void**) (&(*e_216412).Sup.message), LOC45);
			raiseException((Exception*)e_216412, "TimeoutError");
		}
		LA43: ;
		LOC46 = 0;
		LOC46 = ntepochTime();
		HEX2BHEX3D_100688(waited, ((NF)(LOC46) - (NF)(starttime)));
	}
	LA9: ;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(NI, readintobuf_215439)(Socketimpl212410* socket, NI32 flags) {
	NI result;
{	result = 0;
	result = ((NI) 0);
	{
		int LOC5;
		if (!(*socket).isssl) goto LA3;
		LOC5 = 0;
		LOC5 = Dl_210739((*socket).issslU.S1.sslhandle, ((void*) ((*socket).isbufferedU.S1.buffer)), ((NI) 4000));
		result = ((NI) (LOC5));
	}
	goto LA1;
	LA3: ;
	{
		result = recv((*socket).fd, ((void*) ((*socket).isbufferedU.S1.buffer)), ((NI) 4000), flags);
	}
	LA1: ;
	{
		if (!(result < ((NI) 0))) goto LA9;
		(*socket).lasterror = oslasterror_114833();
	}
	LA9: ;
	{
		if (!(result <= ((NI) 0))) goto LA13;
		(*socket).isbufferedU.S1.buflen = ((NI) 0);
		(*socket).isbufferedU.S1.currpos = ((NI) 0);
		goto BeforeRet;
	}
	LA13: ;
	(*socket).isbufferedU.S1.buflen = result;
	(*socket).isbufferedU.S1.currpos = ((NI) 0);
	}BeforeRet: ;
	return result;
}

N_NIMCALL(NI, recv_215634)(Socketimpl212410* socket, void* data, NI size) {
	NI result;
{	result = 0;
	{
		if (!(size == ((NI) 0))) goto LA3;
		goto BeforeRet;
	}
	LA3: ;
	{
		NI read;
		if (!(*socket).isbuffered) goto LA7;
		{
			NI res;
			if (!((*socket).isbufferedU.S1.buflen == ((NI) 0))) goto LA11;
			res = readintobuf_215439(socket, ((NI32) 0));
			{
				if (!(res <= ((NI) 0))) goto LA15;
				{
					if (!NIM_FALSE) goto LA19;
					result = ((NI) 0);
					goto BeforeRet;
				}
				goto LA17;
				LA19: ;
				{
					result = res;
					goto BeforeRet;
				}
				LA17: ;
			}
			LA15: ;
		}
		LA11: ;
		read = ((NI) 0);
		{
			while (1) {
				NI chunk;
				NCSTRING d;
				if (!(read < size)) goto LA23;
				{
					NI res;
					if (!((*socket).isbufferedU.S1.buflen <= (*socket).isbufferedU.S1.currpos)) goto LA26;
					res = readintobuf_215439(socket, ((NI32) 0));
					{
						if (!(res <= ((NI) 0))) goto LA30;
						{
							if (!(((NI) 0) < read)) goto LA34;
							result = read;
							goto BeforeRet;
						}
						goto LA32;
						LA34: ;
						{
							result = res;
							goto BeforeRet;
						}
						LA32: ;
					}
					LA30: ;
				}
				LA26: ;
				chunk = (((NI)((*socket).isbufferedU.S1.buflen - (*socket).isbufferedU.S1.currpos) <= (NI)(size - read)) ? (NI)((*socket).isbufferedU.S1.buflen - (*socket).isbufferedU.S1.currpos) : (NI)(size - read));
				d = ((NCSTRING) (data));
				memcpy(((void*) ((&d[read]))), ((void*) ((&(*socket).isbufferedU.S1.buffer[((*socket).isbufferedU.S1.currpos)- 0]))), ((NI) (chunk)));
				read += chunk;
				(*socket).isbufferedU.S1.currpos += chunk;
			} LA23: ;
		}
		result = read;
	}
	goto LA5;
	LA7: ;
	{
		{
			if (!(*socket).isssl) goto LA40;
			{
				if (!(*socket).issslU.S1.sslhaspeekchar) goto LA44;
				memcpy(data, ((void*) ((&(*socket).issslU.S1.sslpeekchar))), ((NI) 1));
				(*socket).issslU.S1.sslhaspeekchar = NIM_FALSE;
				{
					NCSTRING d;
					int LOC50;
					if (!(((NI) 0) < (NI)(size - ((NI) 1)))) goto LA48;
					d = ((NCSTRING) (data));
					LOC50 = 0;
					LOC50 = Dl_210739((*socket).issslU.S1.sslhandle, ((void*) ((&d[((NI) 1)]))), (NI)(size - ((NI) 1)));
					result = ((NI) ((NI32)(LOC50 + ((NI32) 1))));
				}
				goto LA46;
				LA48: ;
				{
					result = ((NI) 1);
				}
				LA46: ;
			}
			goto LA42;
			LA44: ;
			{
				int LOC53;
				LOC53 = 0;
				LOC53 = Dl_210739((*socket).issslU.S1.sslhandle, data, size);
				result = ((NI) (LOC53));
			}
			LA42: ;
		}
		goto LA38;
		LA40: ;
		{
			result = recv((*socket).fd, data, ((NI) (((int) (size)))), ((NI32) 0));
		}
		LA38: ;
		{
			if (!(result < ((NI) 0))) goto LA57;
			(*socket).lasterror = oslasterror_114833();
		}
		LA57: ;
	}
	LA5: ;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(NI, peekchar_216645)(Socketimpl212410* socket, NIM_CHAR* c) {
	NI result;
{	result = 0;
	{
		if (!(*socket).isbuffered) goto LA3;
		result = ((NI) 1);
		{
			NIM_BOOL LOC7;
			NI res;
			LOC7 = 0;
			LOC7 = ((*socket).isbufferedU.S1.buflen == ((NI) 0));
			if (LOC7) goto LA8;
			LOC7 = ((NI)((*socket).isbufferedU.S1.buflen - ((NI) 1)) < (*socket).isbufferedU.S1.currpos);
			LA8: ;
			if (!LOC7) goto LA9;
			res = readintobuf_215439(socket, ((NI32) 0));
			{
				if (!(res <= ((NI) 0))) goto LA13;
				result = res;
			}
			LA13: ;
		}
		LA9: ;
		(*c) = (*socket).isbufferedU.S1.buffer[((*socket).isbufferedU.S1.currpos)- 0];
	}
	goto LA1;
	LA3: ;
	{
		{
			if (!(*socket).isssl) goto LA18;
			{
				int LOC24;
				if (!!((*socket).issslU.S1.sslhaspeekchar)) goto LA22;
				LOC24 = 0;
				LOC24 = Dl_210739((*socket).issslU.S1.sslhandle, ((void*) ((&(*socket).issslU.S1.sslpeekchar))), ((NI) 1));
				result = ((NI) (LOC24));
				(*socket).issslU.S1.sslhaspeekchar = NIM_TRUE;
			}
			LA22: ;
			(*c) = (*socket).issslU.S1.sslpeekchar;
			goto BeforeRet;
		}
		LA18: ;
		result = recv((*socket).fd, ((void*) (c)), ((NI) 1), MSG_PEEK);
	}
	LA1: ;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, readline_216820)(Socketimpl212410* socket, NimStringDesc** line, NI timeout, NU8 flags) {
	NF waited;
{	waited = 0.0;
	(*line) = setLengthStr((*line), ((NI) 0));
	{
		while (1) {
			NIM_CHAR c;
			NI LOC3;
			NI n;
			c = 0;
			LOC3 = 0;
			LOC3 = waitfor_216034(socket, (&waited), timeout, ((NI) 1), ((NimStringDesc*) &TMP333));
			n = recv_215634(socket, ((void*) ((&c))), ((NI) 1));
			{
				NI32 lasterror;
				if (!(n < ((NI) 0))) goto LA6;
				lasterror = getsocketerror_213204(socket);
				{
					NIM_BOOL LOC10;
					LOC10 = 0;
					LOC10 = isdisconnectionerror_212494(flags, lasterror);
					if (!LOC10) goto LA11;
					(*line) = setLengthStr((*line), ((NI) 0));
					goto BeforeRet;
				}
				LA11: ;
				socketerror_213229(socket, n, NIM_FALSE, lasterror);
			}
			goto LA4;
			LA6: ;
			{
				if (!(n == ((NI) 0))) goto LA14;
				(*line) = setLengthStr((*line), ((NI) 0));
				goto BeforeRet;
			}
			goto LA4;
			LA14: ;
			LA4: ;
			{
				NI LOC20;
				if (!((NU8)(c) == (NU8)(13))) goto LA18;
				LOC20 = 0;
				LOC20 = waitfor_216034(socket, (&waited), timeout, ((NI) 1), ((NimStringDesc*) &TMP333));
				n = peekchar_216645(socket, (&c));
				{
					NIM_BOOL LOC23;
					NI LOC27;
					LOC23 = 0;
					LOC23 = (((NI) 0) < n);
					if (!(LOC23)) goto LA24;
					LOC23 = ((NU8)(c) == (NU8)(10));
					LA24: ;
					if (!LOC23) goto LA25;
					LOC27 = 0;
					LOC27 = recv_215634(socket, ((void*) ((&c))), ((NI) 1));
				}
				goto LA21;
				LA25: ;
				{
					NI32 lasterror;
					if (!(n <= ((NI) 0))) goto LA29;
					lasterror = getsocketerror_213204(socket);
					{
						NIM_BOOL LOC33;
						LOC33 = 0;
						LOC33 = isdisconnectionerror_212494(flags, lasterror);
						if (!LOC33) goto LA34;
						(*line) = setLengthStr((*line), ((NI) 0));
						goto BeforeRet;
					}
					LA34: ;
					socketerror_213229(socket, n, NIM_FALSE, lasterror);
				}
				goto LA21;
				LA29: ;
				LA21: ;
				{
					if (!(((*line) ? (*line)->Sup.len : 0) == ((NI) 0))) goto LA38;
					(*line) = resizeString((*line), 2);
appendString((*line), ((NimStringDesc*) &TMP334));
				}
				LA38: ;
				goto BeforeRet;
			}
			goto LA16;
			LA18: ;
			{
				if (!((NU8)(c) == (NU8)(10))) goto LA41;
				{
					if (!(((*line) ? (*line)->Sup.len : 0) == ((NI) 0))) goto LA45;
					(*line) = resizeString((*line), 2);
appendString((*line), ((NimStringDesc*) &TMP334));
				}
				LA45: ;
				goto BeforeRet;
			}
			goto LA16;
			LA41: ;
			LA16: ;
			(*line) = addChar((*line), c);
		}
	}
	}BeforeRet: ;
}

N_NIMCALL(void, skip_216896)(Socketimpl212410* socket, NI size, NI timeout) {
	NF waited;
	void* dummy;
	NI bytesskipped;
	waited = 0.0;
	dummy = alloc_6001(((NI) (size)));
	bytesskipped = ((NI) 0);
	{
		while (1) {
			NI avail;
			NI LOC3;
			if (!!((bytesskipped == size))) goto LA2;
			avail = waitfor_216034(socket, (&waited), timeout, (NI)(size - bytesskipped), ((NimStringDesc*) &TMP349));
			LOC3 = 0;
			LOC3 = recv_215634(socket, dummy, avail);
			bytesskipped += LOC3;
		} LA2: ;
	}
	dealloc_6048(dummy);
}

N_NIMCALL(NI, recv_216441)(Socketimpl212410* socket, void* data, NI size, NI timeout) {
	NI result;
	NF waited;
	NI read;
{	result = 0;
	waited = 0.0;
	read = ((NI) 0);
	{
		while (1) {
			NI avail;
			NCSTRING d;
			if (!(read < size)) goto LA2;
			avail = waitfor_216034(socket, (&waited), timeout, (NI)(size - read), ((NimStringDesc*) &TMP350));
			d = ((NCSTRING) (data));
			result = recv_215634(socket, ((void*) ((&d[read]))), avail);
			{
				if (!(result == ((NI) 0))) goto LA5;
				goto LA1;
			}
			LA5: ;
			{
				if (!(result < ((NI) 0))) goto LA9;
				goto BeforeRet;
			}
			LA9: ;
			read += result;
		} LA2: ;
	} LA1: ;
	result = read;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, close_214617)(Socketimpl212410* socket) {
	TSafePoint TMP358;
	pushSafePoint(&TMP358);
	TMP358.status = setjmp(TMP358.context);
	if (TMP358.status == 0) {
		{
			int res;
			if (!(*socket).isssl) goto LA4;
			Dl_211580();
			res = Dl_210714((*socket).issslU.S1.sslhandle);
			Dl_210627((*socket).issslU.S1.sslhandle);
			(*socket).issslU.S1.sslhandle = NIM_NIL;
			{
				if (!(res == ((NI32) 0))) goto LA8;
			}
			goto LA6;
			LA8: ;
			{
				if (!!((res == ((NI32) 1)))) goto LA11;
				socketerror_213229(socket, ((NI) (res)), NIM_FALSE, ((NI32) -1));
			}
			goto LA6;
			LA11: ;
			LA6: ;
		}
		LA4: ;
		popSafePoint();
	}
	else {
		popSafePoint();
	}
	{
		close_206028((*socket).fd);
	}
	if (TMP358.status != 0) reraiseException();
}
NIM_EXTERNC N_NOINLINE(void, stdlib_netInit)(void) {
	int LOC1;
	Cryptomallocinit_211204();
	LOC1 = 0;
	LOC1 = Dl_210581();
	Dl_210586();
	Dl_210591();
	Dl_211033();
}

NIM_EXTERNC N_NOINLINE(void, stdlib_netDatInit)(void) {
static TNimNode* TMP291[4];
static TNimNode* TMP292[3];
static TNimNode* TMP293[5];
static TNimNode TMP82[19];
NTI212205.size = sizeof(Sslerror212205);
NTI212205.kind = 17;
NTI212205.base = (&NTI3427);
TMP82[0].len = 0; TMP82[0].kind = 2;
NTI212205.node = &TMP82[0];
NTI212850.size = sizeof(Sslerror212205*);
NTI212850.kind = 22;
NTI212850.base = (&NTI212205);
NTI212850.marker = TMP125;
NTI212410.size = sizeof(Socketimpl212410);
NTI212410.kind = 18;
NTI212410.base = 0;
NTI212410.flags = 3;
TMP291[0] = &TMP82[2];
TMP82[2].kind = 1;
TMP82[2].offset = offsetof(Socketimpl212410, fd);
TMP82[2].typ = (&NTI5811);
TMP82[2].name = "fd";
TMP291[1] = &TMP82[3];
TMP82[3].kind = 3;
TMP82[3].offset = offsetof(Socketimpl212410, isbuffered);
TMP82[3].typ = (&NTI138);
TMP82[3].name = "isBuffered";
TMP82[3].sons = &NimDT_212410_isbuffered[0];
TMP82[3].len = 2;
TMP292[0] = &TMP82[5];
NTI212423.size = sizeof(TY212423);
NTI212423.kind = 16;
NTI212423.base = (&NTI147);
NTI212423.flags = 3;
TMP82[5].kind = 1;
TMP82[5].offset = offsetof(Socketimpl212410, isbufferedU.S1.buffer);
TMP82[5].typ = (&NTI212423);
TMP82[5].name = "buffer";
TMP292[1] = &TMP82[6];
TMP82[6].kind = 1;
TMP82[6].offset = offsetof(Socketimpl212410, isbufferedU.S1.currpos);
TMP82[6].typ = (&NTI108);
TMP82[6].name = "currPos";
TMP292[2] = &TMP82[7];
TMP82[7].kind = 1;
TMP82[7].offset = offsetof(Socketimpl212410, isbufferedU.S1.buflen);
TMP82[7].typ = (&NTI108);
TMP82[7].name = "bufLen";
TMP82[4].len = 3; TMP82[4].kind = 2; TMP82[4].sons = &TMP292[0];
NimDT_212410_isbuffered[1] = &TMP82[4];
TMP82[8].len = 0; TMP82[8].kind = 2;
NimDT_212410_isbuffered[0] = &TMP82[8];
TMP291[2] = &TMP82[9];
TMP82[9].kind = 3;
TMP82[9].offset = offsetof(Socketimpl212410, isssl);
TMP82[9].typ = (&NTI138);
TMP82[9].name = "isSsl";
TMP82[9].sons = &NimDT_212410_isssl[0];
TMP82[9].len = 2;
TMP293[0] = &TMP82[11];
TMP82[11].kind = 1;
TMP82[11].offset = offsetof(Socketimpl212410, issslU.S1.sslhandle);
TMP82[11].typ = (&NTI210407);
TMP82[11].name = "sslHandle";
TMP293[1] = &TMP82[12];
TMP82[12].kind = 1;
TMP82[12].offset = offsetof(Socketimpl212410, issslU.S1.sslcontext);
TMP82[12].typ = (&NTI210407);
TMP82[12].name = "sslContext";
TMP293[2] = &TMP82[13];
TMP82[13].kind = 1;
TMP82[13].offset = offsetof(Socketimpl212410, issslU.S1.sslnohandshake);
TMP82[13].typ = (&NTI138);
TMP82[13].name = "sslNoHandshake";
TMP293[3] = &TMP82[14];
TMP82[14].kind = 1;
TMP82[14].offset = offsetof(Socketimpl212410, issslU.S1.sslhaspeekchar);
TMP82[14].typ = (&NTI138);
TMP82[14].name = "sslHasPeekChar";
TMP293[4] = &TMP82[15];
TMP82[15].kind = 1;
TMP82[15].offset = offsetof(Socketimpl212410, issslU.S1.sslpeekchar);
TMP82[15].typ = (&NTI147);
TMP82[15].name = "sslPeekChar";
TMP82[10].len = 5; TMP82[10].kind = 2; TMP82[10].sons = &TMP293[0];
NimDT_212410_isssl[1] = &TMP82[10];
TMP82[16].len = 0; TMP82[16].kind = 2;
NimDT_212410_isssl[0] = &TMP82[16];
TMP291[3] = &TMP82[17];
TMP82[17].kind = 1;
TMP82[17].offset = offsetof(Socketimpl212410, lasterror);
TMP82[17].typ = (&NTI114);
TMP82[17].name = "lastError";
TMP82[1].len = 4; TMP82[1].kind = 2; TMP82[1].sons = &TMP291[0];
NTI212410.node = &TMP82[1];
NTI212412.size = sizeof(Socketimpl212410*);
NTI212412.kind = 22;
NTI212412.base = (&NTI212410);
NTI212412.flags = 2;
NTI212412.marker = TMP294;
NTI212418.size = sizeof(Timeouterror212418);
NTI212418.kind = 17;
NTI212418.base = (&NTI3427);
TMP82[18].len = 0; TMP82[18].kind = 2;
NTI212418.node = &TMP82[18];
NTI217645.size = sizeof(Timeouterror212418*);
NTI217645.kind = 22;
NTI217645.base = (&NTI212418);
NTI217645.marker = TMP318;
}

